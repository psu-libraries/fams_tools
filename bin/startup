#!/bin/bash
set -e

if [ -f /vault/secrets/config ]; then 
  . /vault/secrets/config
fi

if [ "${RAILS_ENV:-development}" != 'production' ]; then 
  bundle check || bundle
  bundle exec rails db:create db:migrate
fi

rm -f /app/fams_tools/tmp/pids/server.pid

exec bundle exec rails s -p 3000 -b '0.0.0.0'
